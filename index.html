<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Hehebank</title>
<style>
:root {
  --bg: #f0f2f5;
  --card: #ffffff;
  --accent: #4caf50;
  --danger: #f44336;
  --text: #111;
  --muted: #555;
}

* { box-sizing: border-box; }
body { margin:0; font-family:system-ui, Arial,sans-serif; background: var(--bg); color:var(--text); min-height:100vh; display:flex; justify-content:center; padding:20px; }
.container { width:100%; max-width:420px; }
h1 { text-align:center; margin-bottom:20px; }
.card { background:var(--card); border-radius:12px; padding:16px; margin-bottom:16px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
input, button { width:100%; padding:10px; margin-top:8px; border-radius:8px; border:1px solid #ccc; font-size:14px; }
button { background: var(--accent); color:#fff; font-weight:600; border:none; cursor:pointer; }
button.secondary { background:#e0e0e0; color: var(--text); }
button.danger { background: var(--danger); color:#fff; }
.balance { font-size:26px; font-weight:bold; margin:10px 0; }
.small { color:var(--muted); font-size:13px; }
.hidden { display:none; }
.history { max-height:120px; overflow-y:auto; font-size:13px; list-style:none; padding:0; }
.history li { margin-bottom:6px; border-bottom:1px solid #eee; padding-bottom:2px; }
.admin { border:1px solid var(--danger); }
</style>
</head>
<body>
<div class="container">
<h1>üè¶ Hehebank</h1>

<div id="auth" class="card">
  <input id="loginField" placeholder="–õ–æ–≥–∏–Ω">
  <input id="passwordField" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
  <button onclick="loginUser()">–í–æ–π—Ç–∏</button>
  <button class="secondary" onclick="registerUser()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
  <button class="secondary" onclick="loginNoPass()">–ë–µ–∑ –ø–∞—Ä–æ–ª—è</button>
</div>

<div id="bank" class="hidden">
  <div class="card">
    <div class="small" id="userTitle"></div>
    <div class="balance"><span id="balance">0</span> $</div>
    <button onclick="clickMoney()">üí∞ –ö–ª–∏–∫ = $1</button>
  </div>

  <div class="card">
    <div class="small">–ü–µ—Ä–µ–≤–æ–¥</div>
    <input id="toUser" placeholder="–ö–æ–º—É">
    <input id="amount" type="number" placeholder="–°—É–º–º–∞">
    <button onclick="transfer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>

  <div class="card">
    <div class="small">–ö—Ä–µ–¥–∏—Ç—ã</div>
    <input id="loanAmount" type="number" placeholder="–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞">
    <input id="loanInterest" type="number" placeholder="–ü—Ä–æ—Ü–µ–Ω—Ç (%)">
    <button onclick="takeLoan()">–í–∑—è—Ç—å –∫—Ä–µ–¥–∏—Ç</button>
    <ul id="loansList" class="history"></ul>
  </div>

  <div class="card">
    <div class="small">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</div>
    <ul id="historyList" class="history"></ul>
  </div>

  <button class="secondary" onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

<div id="adminPanel" class="card admin hidden">
  <div class="small">üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
  <button onclick="becomeMillionaire()">–°—Ç–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω–µ—Ä–æ–º</button>
  <input id="adminUser" placeholder="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
  <input id="adminAmount" type="number" placeholder="–°—É–º–º–∞">
  <button onclick="giveMoney()">–î–∞—Ç—å –¥–µ–Ω—å–≥–∏</button>
  <button class="danger" onclick="takeMoney()">–û—Ç–æ–±—Ä–∞—Ç—å –¥–µ–Ω—å–≥–∏</button>
  <button class="secondary" onclick="showAll()">–ü–æ–∫–∞–∑–∞—Ç—å –±–∞–∑—É (JSON)</button>
  <pre id="allUsers" class="small" style="background:#eee; padding:5px; margin-top:10px;"></pre>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAJtR-ua4GFV7CNwrpeQZLm4W7MuIVjdlE",
  authDomain: "hehebank-2a84f.firebaseapp.com",
  databaseURL: "https://hehebank-2a84f-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "hehebank-2a84f",
  storageBucket: "hehebank-2a84f.firebasestorage.app",
  messagingSenderId: "85658810632",
  appId: "1:85658810632:web:a519c82b19039ffc9e14bd"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let current = null;

async function getAllUsers() {
  const snapshot = await db.ref('users').once('value');
  return snapshot.val() || {};
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
async function registerUser(){
  const l = loginField.value.trim();
  const p = passwordField.value;
  if(!l || !p) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è");
  const users = await getAllUsers();
  if(users[l]) return alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
  await db.ref('users/' + l).set({password:p, balance:0, history:["–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω"], loans:[]});
  alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");
}

// –í—Ö–æ–¥
async function loginUser(){
  const l = loginField.value.trim();
  const p = passwordField.value;
  const users = await getAllUsers();
  if(!users[l] || (users[l].password && p && users[l].password !== p)){
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
    return;
  }
  current = l;
  document.getElementById("auth").classList.add("hidden");
  document.getElementById("bank").classList.remove("hidden");
  document.getElementById("userTitle").textContent = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " + current;
  if(current==="admin") document.getElementById("adminPanel").classList.remove("hidden");
  db.ref('users/' + current).on('value', snapshot => render(snapshot.val()));
}

// –í—Ö–æ–¥ –±–µ–∑ –ø–∞—Ä–æ–ª—è
async function loginNoPass(){
  const l = loginField.value.trim();
  const users = await getAllUsers();
  if(!users[l]) return alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç");
  current = l;
  document.getElementById("auth").classList.add("hidden");
  document.getElementById("bank").classList.remove("hidden");
  document.getElementById("userTitle").textContent = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " + current;
  if(current==="admin") document.getElementById("adminPanel").classList.remove("hidden");
  db.ref('users/' + current).on('value', snapshot => render(snapshot.val()));
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
function render(data){
  document.getElementById("balance").textContent = data.balance;
  const historyList = document.getElementById("historyList");
  historyList.innerHTML = "";
  if(data.history) data.history.slice().reverse().forEach(h=>{
    const li = document.createElement("li"); li.textContent = h; historyList.appendChild(li);
  });
  const loansList = document.getElementById("loansList");
  loansList.innerHTML = "";
  if(data.loans) data.loans.forEach(l=>{
    const li = document.createElement("li");
    li.textContent = `üí∏ ${l.amount}$ (–ü—Ä–æ—Ü–µ–Ω—Ç: ${l.interest}%)`;
    loansList.appendChild(li);
  });
}

// –ö–ª–∏–∫–µ—Ä
async function clickMoney(){
  const ref = db.ref('users/' + current);
  const snap = await ref.once('value');
  const data = snap.val();
  data.balance++; data.history.push("+1$ (–∫–ª–∏–∫)");
  await ref.set(data);
}

// –ü–µ—Ä–µ–≤–æ–¥—ã
async function transfer(){
  const to = toUser.value.trim();
  const amountVal = parseInt(amount.value);
  const users = await getAllUsers();
  if(!users[to] || amountVal <=0 || users[current].balance<amountVal) return alert("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞");
  users[current].balance -= amountVal; users[current].history.push(`-${amountVal}$ ‚Üí ${to}`);
  users[to].balance += amountVal; users[to].history.push(`+${amountVal}$ ‚Üê ${current}`);
  await db.ref('users/' + current).set(users[current]);
  await db.ref('users/' + to).set(users[to]);
}

// –ö—Ä–µ–¥–∏—Ç—ã
async function takeLoan(){
  const amt = parseInt(loanAmount.value);
  const pct = parseInt(loanInterest.value);
  if(!amt || !pct) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∏ –ø—Ä–æ—Ü–µ–Ω—Ç");
  const ref = db.ref('users/' + current);
  const snap = await ref.once('value'); const data = snap.val();
  data.balance += amt;
  if(!data.loans) data.loans = [];
  data.loans.push({amount: amt, interest: pct});
  data.history.push(`üí∞ –í–∑—è–ª –∫—Ä–µ–¥–∏—Ç: ${amt}$ –ø–æ–¥ ${pct}%`);
  await ref.set(data);
}

// –ê–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏
async function becomeMillionaire(){
  const ref = db.ref('users/' + current);
  const snap = await ref.once('value'); const data = snap.val();
  data.balance = 1000000; data.history.push("üíé –°—Ç–∞–ª –º–∏–ª–ª–∏–æ–Ω–µ—Ä–æ–º");
  await ref.set(data);
}
async function giveMoney(){
  const user = adminUser.value.trim(); const amt = parseInt(adminAmount.value);
  if(!user || !amt) return;
  const snap = await db.ref('users/' + user).once('value'); const data = snap.val();
  data.balance += amt; data.history.push(`+${amt}$ –æ—Ç –∞–¥–º–∏–Ω–∞`);
  await db.ref('users/' + user).set(data);
}
async function takeMoney(){
  const user = adminUser.value.trim(); const amt = parseInt(adminAmount.value);
  if(!user || !amt) return;
  const snap = await db.ref('users/' + user).once('value'); const data = snap.val();
  data.balance -= amt; data.history.push(`-${amt}$ –∞–¥–º–∏–Ω –∑–∞–±—Ä–∞–ª`);
  await db.ref('users/' + user).set(data);
}
async function showAll(){
  const users = await getAllUsers();
  document.getElementById("allUsers").textContent = JSON.stringify(users, null,2);
}
function logout(){ location.reload(); }
</script>
</body>
  </html>
