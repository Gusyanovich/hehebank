<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hehebank: Ultimate Control</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root { --bg: #05070a; --card: #111827; --accent: #10b981; --danger: #ef4444; --text: #f8fafc; --admin-gold: #fbbf24; }
body { margin:0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color:var(--text); padding:10px; }
.container { max-width: 550px; margin: 0 auto; }
.card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #1f2937; }
input, button { width:100%; padding:10px; margin-top:5px; border-radius:6px; border:none; font-size:14px; box-sizing: border-box; }
button { background: var(--accent); color: white; font-weight: bold; cursor: pointer; transition: 0.2s; }
button:active { transform: scale(0.98); }
.secondary { background: #4b5563; }
.danger { background: var(--danger); }
.balance { font-size: 28px; font-weight: 800; color: #34d399; margin: 10px 0; }
.small { color: #94a3b8; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; }
.hidden { display: none; }
.stock-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
canvas { max-height: 100px; margin-top: 10px; }
.history { max-height: 150px; overflow-y: auto; font-size: 12px; list-style: none; padding: 0; border-top: 1px solid #334155; }
.history li { padding: 5px 0; border-bottom: 1px solid #334155; }

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –∞–¥–º–∏–Ω–∫–∏ */
#adminPanel { border: 2px solid var(--admin-gold); background: #000; }
.adm-section { border-bottom: 1px solid #222; padding: 10px 0; margin-bottom: 5px; }
.adm-row { display: flex; gap: 5px; align-items: center; margin-top: 5px; }
.adm-row input { margin-top: 0; flex: 2; background: #111; color: #fff; border: 1px solid #333; }
.adm-row button { margin-top: 0; flex: 1; font-size: 12px; padding: 8px; }
.adm-title { color: var(--admin-gold); font-weight: 900; margin-bottom: 10px; text-align: center; border-bottom: 1px solid var(--admin-gold); padding-bottom: 5px; }
.adm-label { font-size: 10px; color: #666; display: block; margin-bottom: 2px; }
</style>
</head>
<body>

<div class="container">
    <div id="auth" class="card">
        <h1>üè¶ Hehebank v2.6</h1>
        <input id="loginField" placeholder="–õ–æ–≥–∏–Ω">
        <input id="passwordField" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button onclick="loginUser()">–í–æ–π—Ç–∏</button>
        <button class="secondary" onclick="registerUser()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    </div>

    <div id="bank" class="hidden">
        <div class="card">
            <div id="userDisplay" class="small"></div>
            <div class="balance"><span id="balance">0</span> $</div>
            <div id="bonusText" class="small">–ë–æ–Ω—É—Å –∫–ª–∏–∫–∞: +$1</div>
            <button onclick="clickMoney()">üí∞ –ó–ê–†–ê–ë–û–¢–ê–¢–¨</button>
        </div>

        <div class="card">
            <div class="small">üìâ –†–´–ù–û–ö</div>
            <select id="stockSelector" onchange="updateChartDisplay()" style="width:100%; padding:10px; background:#1e293b; color:white; border-radius:8px; margin-top:10px;">
                <option value="mapple">Mapple (üçé)</option>
                <option value="mycrohard">Mycrohard (üñ•Ô∏è)</option>
                <option value="colacoko">ColaCoko (ü•§)</option>
            </select>
            <canvas id="stockChart"></canvas>
            <div class="balance" style="font-size: 20px;">–ö—É—Ä—Å: <span id="currentStockPrice">0</span> $</div>
            <div class="stock-grid">
                <button onclick="trade('buyAll')">–ö—É–ø–∏—Ç—å Max</button>
                <button class="danger" onclick="trade('sellAll')">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
            </div>
        </div>

        <div class="card">
            <div class="small">üè† –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–¨</div>
            <button class="secondary" onclick="buyHouse('village', 1000)">–°–µ–ª–æ ($1k)</button>
            <button class="secondary" onclick="buyHouse('capital', 10000)">–°—Ç–æ–ª–∏—Ü–∞ ($10k)</button>
            <button class="secondary" onclick="buyHouse('moscow', 100000)">–ú–æ—Å–∫–≤–∞ ($100k)</button>
            <button class="secondary" onclick="buyHouse('dubai', 1000000)">–î—É–±–∞–π ($1M)</button>
        </div>

        <div class="card">
            <div class="small">üìú –õ–û–ì–ò</div>
            <ul id="historyList" class="history"></ul>
            <button class="secondary" onclick="logout()" style="margin-top:10px;">–í–´–•–û–î</button>
        </div>
    </div>

    <div id="adminPanel" class="card hidden">
        <div class="adm-title">OVERLORD CONTROL PANEL</div>
        
        <div class="adm-section">
            <span class="adm-label">–£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ï–ù–¨–ì–ê–ú–ò</span>
            <div class="adm-row">
                <input id="adm_money_uid" placeholder="UID –∏–≥—Ä–æ–∫–∞">
                <input id="adm_money_amt" type="number" placeholder="–°—É–º–º–∞">
                <button onclick="ovl('giveMoney')">–í–´–î–ê–¢–¨</button>
            </div>
            <div class="adm-row">
                <input id="adm_set_uid" placeholder="UID –∏–≥—Ä–æ–∫–∞">
                <input id="adm_set_amt" type="number" placeholder="–¢–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å">
                <button class="danger" onclick="ovl('setBalance')">SET</button>
            </div>
        </div>

        <div class="adm-section">
            <span class="adm-label">–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨</span>
            <div class="adm-row">
                <input id="adm_ban_uid" placeholder="UID –∏–≥—Ä–æ–∫–∞">
                <button class="danger" onclick="ovl('ban')">–ë–ê–ù / –†–ê–ó–ë–ê–ù</button>
            </div>
            <div class="adm-row">
                <input id="adm_pass_uid" placeholder="UID –∏–≥—Ä–æ–∫–∞">
                <input id="adm_pass_new" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                <button onclick="ovl('changePass')">–°–ú–ï–ù–ò–¢–¨</button>
            </div>
        </div>

        <div class="adm-section">
            <span class="adm-label">–ú–ê–ù–ò–ü–£–õ–Ø–¶–ò–Ø –†–´–ù–ö–û–ú (–í–´–ë–†–ê–ù–ù–´–ô –¢–ò–ö–ï–†)</span>
            <div class="stock-grid">
                <button onclick="ovl('pump')">üöÄ –ü–ê–ú–ü x2</button>
                <button class="danger" onclick="ovl('dump')">üìâ –î–ê–ú–ü x0.5</button>
                <button class="danger" onclick="ovl('crash')">üíÄ –û–ë–ù–£–õ–ò–¢–¨ –ö–£–†–°</button>
            </div>
        </div>

        <div class="adm-section">
            <span class="adm-label">–ì–ï–ô–ú–ü–õ–ï–ô</span>
            <div class="adm-row">
                <input id="adm_bonus_uid" placeholder="UID –∏–≥—Ä–æ–∫–∞">
                <input id="adm_bonus_val" type="number" placeholder="+ –∑–∞ –∫–ª–∏–∫">
                <button onclick="ovl('setBonus')">–£–°–¢–ê–ù–û–í–ò–¢–¨</button>
            </div>
        </div>

        <div class="adm-section">
            <span class="adm-label">–°–ò–°–¢–ï–ú–ù–´–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø</span>
            <div class="adm-row">
                <input id="adm_msg_uid" placeholder="UID (–∏–ª–∏ 'all')">
                <input id="adm_msg_txt" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è">
                <button onclick="ovl('msg')">–û–¢–ü–†–ê–í–ò–¢–¨</button>
            </div>
        </div>

        <div class="adm-section">
            <span class="adm-label" style="color:red">OP ZONE</span>
            <div class="stock-grid">
                <button class="danger" onclick="ovl('taxDay')">üí∏ –ù–ê–õ–û–ì 20% (–í–°–ï)</button>
                <button class="danger" onclick="ovl('armageddon')">‚ò¢Ô∏è –ê–†–ú–ê–ì–ï–î–î–û–ù</button>
            </div>
            <button class="secondary" style="margin-top:5px" onclick="ovl('audit')">üîç –ü–û–õ–ù–´–ô –î–ê–ú–ü –ë–ê–ó–´ (JSON)</button>
        </div>

        <pre id="adm_out" style="background:#000; color:#0f0; font-size:10px; padding:8px; margin-top:10px; border:1px solid #333; max-height:80px; overflow:auto;"></pre>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAJtR-ua4GFV7CNwrpeQZLm4W7MuIVjdlE",
  databaseURL: "https://hehebank-2a84f-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "hehebank-2a84f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let current = null;
let prices = { mapple: 100, mycrohard: 150, colacoko: 50 };
let chartData = { mapple: [100], mycrohard: [150], colacoko: [50] };

const ctx = document.getElementById('stockChart').getContext('2d');
const myChart = new Chart(ctx, {
    type: 'line',
    data: { labels: [], datasets: [{ label: '–¶–µ–Ω–∞', data: [], borderColor: '#10b981', borderWidth: 2, pointRadius: 0, fill: false }] },
    options: { scales: { x: { display: false }, y: { grid: { color: '#1f2937' } } }, plugins: { legend: { display: false } } }
});

async function loginUser() {
    const l = loginField.value.trim(), p = passwordField.value;
    const s = await db.ref('users/' + l).once('value');
    if(!s.exists() || s.val().password !== p) return alert("–û—à–∏–±–∫–∞");
    if(s.val().isBanned) return alert("BANNED");
    current = l;
    auth.classList.add("hidden"); bank.classList.remove("hidden");
    if(current === 'admin') adminPanel.classList.remove("hidden");
    db.ref('users/' + current).on('value', snap => render(snap.val()));
}

async function registerUser() {
    const l = loginField.value.trim(), p = passwordField.value;
    const s = await db.ref('users/' + l).once('value');
    if(s.exists()) return alert("–ó–∞–Ω—è—Ç–æ");
    await db.ref('users/' + l).set({password:p, balance:500, history:["Start"], stocks:{mapple:{q:0,avg:0},mycrohard:{q:0,avg:0},colacoko:{q:0,avg:0}}, houses:[], clickBonus:1});
    alert("OK");
}

function render(d) {
    if(!d) return;
    balance.textContent = Math.floor(d.balance).toLocaleString();
    userDisplay.textContent = `USER: ${current}`;
    let b = d.clickBonus || 1;
    if(d.houses?.includes('village')) b += 2;
    if(d.houses?.includes('capital')) b += 10;
    if(d.houses?.includes('moscow')) b += 50;
    if(d.houses?.includes('dubai')) b += 200;
    bonusText.textContent = `–ö–ª–∏–∫: +$${b}`;
    historyList.innerHTML = "";
    d.history?.slice(-10).reverse().forEach(h => {
        const li = document.createElement("li"); li.textContent = h; historyList.appendChild(li);
    });
}

function clickMoney() {
    db.ref('users/' + current).once('value', s => {
        let u = s.val();
        let b = u.clickBonus || 1;
        if(u.houses?.includes('village')) b += 2;
        if(u.houses?.includes('capital')) b += 10;
        if(u.houses?.includes('moscow')) b += 50;
        if(u.houses?.includes('dubai')) b += 200;
        db.ref('users/' + current + '/balance').set(u.balance + b);
    });
}

setInterval(() => {
    for (let s in prices) {
        prices[s] = Math.max(1, prices[s] + (prices[s] * ((Math.random() > 0.48 ? -1 : 1) * (Math.random() * 0.03))));
        chartData[s].push(prices[s]);
        if(chartData[s].length > 20) chartData[s].shift();
    }
    updateChartDisplay();
}, 4000);

function updateChartDisplay() {
    const s = stockSelector.value;
    currentStockPrice.textContent = prices[s].toFixed(2);
    myChart.data.labels = chartData[s].map((_, i) => i);
    myChart.data.datasets[0].data = chartData[s];
    myChart.update('none');
}

async function trade(type) {
    const s = stockSelector.value;
    const ref = db.ref('users/' + current);
    const snap = await ref.once('value'); let u = snap.val();
    const curP = prices[s];
    if(type === 'buyAll') {
        let q = Math.floor(u.balance / curP);
        if(q <= 0) return;
        u.stocks[s].avg = ((u.stocks[s].q * u.stocks[s].avg) + (q * curP)) / (u.stocks[s].q + q);
        u.stocks[s].q += q; u.balance -= (q * curP);
    } else {
        if(u.stocks[s].q <= 0) return;
        u.balance += u.stocks[s].q * curP; u.stocks[s].q = 0;
    }
    ref.set(u);
}

async function buyHouse(id, c) {
    const ref = db.ref('users/' + current);
    const snap = await ref.once('value'); let u = snap.val();
    if(u.balance >= c && !u.houses?.includes(id)) {
        u.balance -= c; if(!u.houses) u.houses = []; u.houses.push(id);
        ref.set(u);
    }
}

// --- üëë –õ–û–ì–ò–ö–ê –ü–ê–ù–ï–õ–ò –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê ---
async function ovl(action) {
    const out = document.getElementById("adm_out");
    out.innerText = "Processing...";
    
    const ticker = stockSelector.value;

    if(action === 'giveMoney') {
        const u = document.getElementById('adm_money_uid').value;
        const a = parseInt(document.getElementById('adm_money_amt').value);
        await db.ref('users/'+u+'/balance').transaction(b => (b||0)+a);
        await db.ref('users/'+u+'/history').push(`üéÅ ADMIN: +$${a}`);
    } 
    else if(action === 'setBalance') {
        const u = document.getElementById('adm_set_uid').value;
        const a = parseInt(document.getElementById('adm_set_amt').value);
        await db.ref('users/'+u+'/balance').set(a);
    }
    else if(action === 'ban') {
        const u = document.getElementById('adm_ban_uid').value;
        const s = await db.ref('users/'+u+'/isBanned').once('value');
        await db.ref('users/'+u+'/isBanned').set(!s.val());
    }
    else if(action === 'changePass') {
        const u = document.getElementById('adm_pass_uid').value;
        const p = document.getElementById('adm_pass_new').value;
        await db.ref('users/'+u+'/password').set(p);
    }
    else if(action === 'setBonus') {
        const u = document.getElementById('adm_bonus_uid').value;
        const v = parseInt(document.getElementById('adm_bonus_val').value);
        await db.ref('users/'+u+'/clickBonus').set(v);
    }
    else if(action === 'msg') {
        const u = document.getElementById('adm_msg_uid').value;
        const t = document.getElementById('adm_msg_txt').value;
        if(u === 'all') {
            const all = await db.ref('users').once('value');
            all.forEach(c => db.ref('users/'+c.key+'/history').push("üì¢ "+t));
        } else {
            await db.ref('users/'+u+'/history').push("üì¢ "+t);
        }
    }
    else if(action === 'pump') { prices[ticker] *= 2; updateChartDisplay(); }
    else if(action === 'dump') { prices[ticker] *= 0.5; updateChartDisplay(); }
    else if(action === 'crash') { prices[ticker] = 1; updateChartDisplay(); }
    else if(action === 'taxDay') {
        const all = await db.ref('users').once('value');
        all.forEach(c => db.ref('users/'+c.key+'/balance').transaction(b => b*0.8));
        alert("–ù–∞–ª–æ–≥ 20% —Å–æ–±—Ä–∞–Ω");
    }
    else if(action === 'armageddon') {
        if(confirm("–û–ë–ù–£–õ–ò–¢–¨ –í–°–ï–•?")) {
            const all = await db.ref('users').once('value');
            all.forEach(c => { if(c.key !== 'admin') db.ref('users/'+c.key+'/balance').set(0); });
        }
    }
    else if(action === 'audit') {
        const all = await db.ref('users').once('value');
        out.innerText = JSON.stringify(all.val(), null, 2);
        return;
    }
    out.innerText = "SUCCESS: " + action;
}

function logout() { location.reload(); }
</script>
</body>
</html>
